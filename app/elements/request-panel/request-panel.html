<dom-module id="request-panel">
  <template>
    <style>
    :host {
      display: block;
    }
    #basicAuthDialog {
      top: 10px;
    }
    .cookie-exchange-banner {
      margin: 0 16px;
      margin-bottom: 24px;
    }
    .cookie-monster {
      margin-left: 24px;
    }
    .cookie-exchange-banner p {
      @apply(--paper-font-body2);
    }
    .inherit {
      color: inherit !important;
      background-color: inherit !important;
    }
    </style>
    <arc-request-view status-message="[[statusMessage]]" request-loading="[[requestLoading]]" opened="{{opened}}" request="{{request}}" content-type="{{contentType}}"></arc-request-view>
    <template is="dom-if" if="[[hasResponse]]">
      <arc-response-view opened="[[opened]]" response="[[response]]" request="[[activeRequest]]"></arc-response-view>
    </template>
    <arc-save-dialog-view id="saveRequestUi"></arc-save-dialog-view>
    <div class="cookie-exchange-banner" hidden$="[[!showCookieBanner]]">
      <h2>
        Missing cookies?
        <img src="/assets/cookie-monster.png" width="166" height="112" class="cookie-monster"/>
      </h2>
      <p>The app is not able to read cookies set in Chrome browser. If you authenticated yourself in a Chrome tab cookies are not transfered automatically.</p>
      <p>Install ARC cookie exchange extension and synchronize cookies between the app and Chrome.</p>
      <a href="https://chrome.google.com/webstore/detail/apcedakaoficjlofohhcmkkljehnmebp" class="inherit" target="_blank">
        <paper-button raised>Install ARC cookie exchange</paper-button>
      </a>
    </div>
    <arc-request-error-view hidden$=[[!isError]] message="[[errorMessage]]"></arc-request-error-view>
    <chrome-storage auto id="latest" type="local" name="latestRequest" value="{{request}}" on-read="_latestLoaded"></chrome-storage>
    <arc-socket-request id="socket" on-ready="_responseReady" on-error="_onRequestError"></arc-socket-request>
    <arc-xhr-request id="xhr" on-ready="_responseReady" on-error="_onRequestError" connected="{{xhrConnected}}"></arc-xhr-request>
    <arc-magic-variables id="magicVariables" scope="[[project.id]]"></arc-magic-variables>
    <cookie-storage use-pouch-db="true" id="cookieJar" url="[[request.url]]" cookie="{{requestCookie}}" response-headers="[[response.headers]]"></cookie-storage>
    <cookie-exchange external-id="apcedakaoficjlofohhcmkkljehnmebp" id="cookieExchange"></cookie-exchange>
    <auth-data-saver id="authSaver" on-resend-auth-request="_resendAuthRequest" headers="{{request.headers}}" url="[[request.url]]"></auth-data-saver>
    <response-history-saver id="responseSaver"></response-history-saver>
    <install-proxy-dialog id="proxyDialog"></install-proxy-dialog>
    <paper-toast id="clearRollback" duration="5000" text="Request cleared" on-iron-overlay-closed="_clearUndoClear">
      <paper-button on-tap="_undoClear" class="yellow-button">Undo</paper-button>
    </paper-toast>
    <!-- <legacyproject-related-requests project-id="[[projectId]]" related-requests="{{currentProjectEndpoints}}"></legacyproject-related-requests> -->
    <uuid-generator id="uuid"></uuid-generator>
    <url-history-saver id="urlHistory"></url-history-saver>
    <request-saver id="requestSaver" request="[[request]]" on-request-saved="_requestSavedHandler" on-error="_requestSaveErrorHandler"></request-saver>
    <paper-toast text="Your request has been saved. Add SHIFT key to display save dialog." id="requestSavedFastToast"></paper-toast>
    <paper-toast text="Request has been saved" id="requestSavedToast"></paper-toast>
  </template>
  <script src="request-panel.js"></script>
</dom-module>
