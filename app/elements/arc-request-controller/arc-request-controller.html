<!--
@license
Copyright 2016 Pawel Psztyc, The ARC team

Licensed under the Apache License, Version 2.0 (the "License"); you may not
use this file except in compliance with the License. You may obtain a copy of
the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
License for the specific language governing permissions and limitations under
the License.
-->
<!--
A request kept in the local storage is not a type of Request object.
This is a simple mapping to current request form options.
Other methods may translate this objecy to the RequestObject depending on the action (eg. save action). But then it still will be copy og this object.
So the idea is that the editor is working on a different object than it may be used to store data. This will simplify data flow in the app.

Final local copy of the object stored as a `latestRequest` is:
```
{
  url: 'String', // a url of the request,
  method: 'String', //a HTTP method
  headers: 'String', // A HTTP message part with the string values.
  payload: 'Any', // a payload message,
  isSaved: 'Boolean', // (Optional) true if original request that created this object originated from saved request, may be not set. If isSaved and isDrive is false then the object represents history object
  isDrive: 'Boolean', // (Optional) true if original request that created this object originated from google drive, may be not set.
  id: 'String|Number' // (Optional) type depends on isSaved and isDrive, the ID of the original object, may be not set.
}
```
-->
<dom-module id="arc-request-controller">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>
    <content></content>
    <arc-request-error-view hidden$=[[!isError]] message="[[errorMessage]]"></arc-request-error-view>
    <chrome-storage debug auto id="latest" type="local" name="latestRequest" value="{{request}}"  value-as="RequestLocalObject" on-read="_latestLoaded"></chrome-storage>
    <arc-socket-request id="socket" on-ready="_responseReady" on-error="_onRequestError"></arc-socket-request>
    <arc-historyurl-model id="historyurlModel" on-save="_historyUrlSaved" on-error="_historyUrlSaveError"></arc-historyurl-model>
    <arc-request-object-model id="requestModel" on-data-ready="_requestObjectReady" on-save="_onHistorySave"></arc-request-object-model>
    <arc-request-object-model id="requestQueryModel" on-data-ready="_requestObjectRestored"></arc-request-object-model>
    <arc-request-object-model id="projectQueryModel" on-data-ready="_projectEndpointsRestored"></arc-request-object-model>
    <arc-project-object-model id="projects" on-error="_projectSaveError"></arc-project-object-model>
    
  </template>
  <script src="arc-request-controller.js"></script>
</dom-module>
