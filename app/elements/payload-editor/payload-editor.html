<!--
@license
Copyright 2016 Pawel Psztyc, The ARC team

Licensed under the Apache License, Version 2.0 (the "License"); you may not
use this file except in compliance with the License. You may obtain a copy of
the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
License for the specific language governing permissions and limitations under
the License.
-->
<link rel="import" href="multipart-payload-editor.html">
<link rel="import" href="file-editor.html">

<dom-module id="payload-editor">
  <template>
    <style>
     :host {
      display: block;
      position: relative;
      --code-mirror-wrapper: {
        border: 1px var(--main-section-border-color) solid;
      }
      ;
      --code-mirror-editor: {
        z-index: 0;
      }
      ;
    }

    input::-webkit-input-placeholder {
      color: var(--paper-input-container-color, --secondary-text-color);
    }

    .params-title {
      @apply(--paper-font-caption);
      color: #737373;
    }

    .form-row {
      @apply(--layout-horizontal);
      @apply(--layout-flex);
      @apply(--layout-center);
    }

    .param-name {
      margin-right: 12px;
    }

    .param-value {
      @apply(--layout-flex);
    }

    .encoder-buttons {
      margin: 8px 0;
    }

    .add-param-button {
      margin-top: 12px;
    }

    .form-info {
      @apply(--layout-horizontal);
      @apply(--layout-flex);
      @apply(--layout-center-center);
    }

    .form-info>div {
      @apply(--layout-vertical);
    }

    .title-header {
      @apply(--layout-horizontal);
      @apply(--layout-center);
      padding: 0 12px;
    }

    .panel-options {
      @apply(--layout-horizontal);
      @apply(--layout-center);
      margin-top: 20px;
    }

    h2 {
      @apply(--paper-font-subhead);
      padding-bottom: 0;
      margin-bottom: 6px;
      font-weight: 500;
    }

    .flex {
      @apply(--layout-flex);
    }

    iron-pages {
      padding: 12px;
    }

    paper-dropdown-menu {
      margin-right: 12px;
    }

    paper-dropdown-menu.type {
      padding: 0 12px;
      min-width: 320px;
    }
    </style>

    <section class="panel-options">
      <paper-dropdown-menu class="type" label="Editor view">
        <paper-listbox class="dropdown-content" selected="{{tabSelected}}">
          <paper-item>Text input</paper-item>
          <paper-item>Form data (text form)</paper-item>
          <paper-item>Multipart form data (form with files)</paper-item>
          <paper-item>File</paper-item>
        </paper-listbox>
      </paper-dropdown-menu>
      <paper-dropdown-menu label="Body content type" hidden$="[[_computeContentTypeSelectorHidden(tabSelected)]]">
        <paper-listbox class="dropdown-content" on-iron-select="_contentTypeSelected" selected="[[contentType]]" attr-for-selected="data-type">
          <paper-item data-type="application/json">application/json</paper-item>
          <paper-item data-type="application/xml">application/xml</paper-item>
          <paper-item data-type="application/atom+xml">application/atom+xml</paper-item>
          <paper-item data-type="multipart/form-data">multipart/form-data</paper-item>
          <paper-item data-type="multipart/alternative">multipart/alternative</paper-item>
          <paper-item data-type="multipart/mixed">multipart/mixed</paper-item>
          <paper-item data-type="application/x-www-form-urlencoded">application/x-www-form-urlencoded</paper-item>
          <paper-item data-type="application/base64">application/base64</paper-item>
          <paper-item data-type="application/octet-stream">application/octet-stream</paper-item>
          <paper-item data-type="text/plain">text/plain</paper-item>
          <paper-item data-type="text/css">text/css</paper-item>
          <paper-item data-type="text/html">text/html</paper-item>
          <paper-item data-type="application/javascript">application/javascript</paper-item>
        </paper-listbox>
      </paper-dropdown-menu>
    </section>

      <iron-pages selected="{{tabSelected}}" selected-attribute="opened">
        <section>
          <div hidden$="[[!withForm]]" class="encoder-buttons">
            <paper-button title="Encodes payload to x-www-form-urlencoded data" on-tap="encodePaylod">encode payload</paper-button>
            <paper-button title="Decodes payload to human readable form" on-tap="decodePaylod">decode payload</paper-button>
          </div>
          <code-mirror mode="application/json" theme="cm-arc" value="{{value}}" id="cm"></code-mirror>
        </section>
        <section class="params-list">
          <div class="encoder-buttons">
            <paper-button title="Encodes payload to x-www-form-urlencoded data" on-tap="encodePaylod">encode payload</paper-button>
            <paper-button title="Decodes payload to human readable form" on-tap="decodePaylod">decode payload</paper-button>
          </div>
          <template is="dom-repeat" id="valuesList" items="{{valuesList}}" on-dom-change="_onParamsRender">
            <div class="form-row">
              <paper-input-container class="param-name" no-label-float inline>
                <input is="iron-input" type="text" value="{{item.name::input}}" placeholder="Param name" />
              </paper-input-container>
              <paper-input-container class="param-value" no-label-float inline>
                <input is="iron-input" type="text" value="{{item.value::input}}" placeholder="Param value" />
              </paper-input-container>
              <paper-icon-button icon="arc:close" title="Remove param" on-tap="_removeParam"></paper-icon-button>
            </div>
          </template>
          <paper-button raised on-tap="appendEmptyParam" class="add-param-button">Add another parameter</paper-button>
        </section>
        <section>
          <multipart-payload-editor form-data="{{formData}}" value="{{multipart}}"></multipart-payload-editor>
        </section>
        <section>
          <file-editor value="{{file}}"></file-editor>
        </section>
      </iron-pages>

  </template>
  <script src="payload-editor.js"></script>
</dom-module>
